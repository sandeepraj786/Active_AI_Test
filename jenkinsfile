pipeline {
    agent any
    stages {
	    stage('SCM Checkout'){
             steps{    
		    git 'https://github.com/sandeepraj786/Active_AI_Test.git'
		 }
	    }
	    
	    stage('crate image and push to ecr'){
	        steps{
		        cd /var/lib/jenkins/workspace/Chatbot-Active-Ai-job/backend
			}
                steps{			
			sudo docker build -t backend .
			}
		steps{	
			docker tag backend:latest 769585693008.dkr.ecr.us-east-2.amazonaws.com/backend:latest
			}
	         steps{		
			docker push 769585693008.dkr.ecr.us-east-2.amazonaws.com/backend:latest
			}
			
		    }
	          
	    }
            stage('Run Ansible playbook') {
               steps {
	               sh ' ansible-playbook /var/lib/jenkins/workspace/Chatbot-Active-Ai-job/ansible/deploy-chatbot-ai.yml'
                     
	             
         }
       }
    }
}
